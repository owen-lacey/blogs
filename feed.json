{
	"version": "https://jsonfeed.org/version/1",
	"title": "Owen Lacey",
	"icon": "https://micro.blog/owenlacey/avatar.jpg",
	"home_page_url": "https://blog.owenlacey.dev/",
	"feed_url": "https://blog.owenlacey.dev/feed.json",
	"items": [
		
			{
				"id": "http://owenlacey.micro.blog/2025/04/28/nextjs.html",
				"title": "I made my website show what I'm listening to on Spotify",
				"content_html": "<p>I&rsquo;ve recently found myself as a lead developer on a Next.js project. There&rsquo;s a .NET API that acts as the backend, which is much more within my comfort zone, but I&rsquo;m definitely finding myself on the less-prepared side of things on the frontend.</p>\n<p>Server-side rendering has always been a bit mysterious to me: I struggle to properly grasp the benefit of something until I&rsquo;ve got a use-case that&rsquo;s meaningful to me. With quite a lot of my experience being for business-facing enterprise web apps, the benefits Next.js adds are usually fairly low down on the priority list, so it was easier for me to dismiss it as just the latest fad in web development. Until recently.</p>\n<p>Recently, something clicked. Fairly often, I&rsquo;d have have an idea for a personal project and due to my experience as a full-stack dev it&rsquo;s not long before I start thinking about things like databases &amp; integrations. This is what usually stops me; when an idea becomes multiple executable applications, not to mention their own CI/CD requirements, it feels like too much hassle for me to do in my spare time. It was only when I considered a Next.js application like two separate applications, backend and frontend, rolled into one I immediately found a use case that I was excited about.</p>\n<h2 id=\"my-use-case\">My use case</h2>\n<p>I thought it would be cool for <a href=\"https://owenlacey.dev\">my website</a> to show what I&rsquo;m currently listening to on spotify. From <a href=\"https://developer.spotify.com/documentation/web-api\">their API docs</a> it seemed like a relatively straightforward integration. When playing around with their sandbox I was horrified to learn that <a href=\"https://open.spotify.com/track/5HF2zdaYT7zpQGrkg1hP4v?si=a5ac0094429144c4\">Five Little Ducks</a> had made it into my top 5 songs of all time (don&rsquo;t have kids). All I needed to do was generate a client id / secret and start messing about with it, the only problem is I don&rsquo;t want to expose any secrets in my website.</p>\n<p>In this case, it&rsquo;s quite easy to find the secrets by checking the network tab for network requests to the spotify API:\n<!-- raw HTML omitted -->\nNow, I can&rsquo;t imagine you&rsquo;re going to do much more damage to my music library than my two-year-old currently is, but it still isn&rsquo;t good practice. I decided I&rsquo;d migrate my React application to Next.js so that this integration could take place entirely on the server and I could keep my secrets just that: secret.</p>\n<h2 id=\"migrating-to-nextjs\">Migrating to Next.js</h2>\n<p><a href=\"https://nextjs.org/docs/app/guides/migrating/from-vite\">This guide</a> for migrating my app to Next.js took me about 30 minutes, the only obstacles I had here was fixing eslint errors introduced when following the guide. Because my CI/CD pipeline just does <code>npm run build</code>, I had my website migrated over to Next.js in no time. I&rsquo;ve been developing long enough to know how rare it is for a migration to go this smoothly.</p>\n<p>Job done, right? No. Just because I&rsquo;ve migrated my app to Next.js doesn&rsquo;t mean the necessary parts are server-side rendered. Indeed, those pesky token requests continued to happen because I bundled my whole <code>App</code> in the client using the <code>&quot;use client&quot;</code> directive.</p>\n<!-- raw HTML omitted -->\n<p>I reached a fork in the road here where I felt I needed to choose between the following:</p>\n<ol>\n<li>Move the boundary between server and client to a higher level so I can be pickier about which components are rendered where. At the point of writing, the only responsive part of my application is related to the floating objects (see <a href=\"https://blog.owenlacey.dev/2025/02/24/animated-images-on-my-website.html\">here</a>, and the &lsquo;fun fact&rsquo; shuffle thing; the rest is just static text.</li>\n<li>Use server actions to make an authenticated request with spotify under the hood without exposing the configured secrets.</li>\n</ol>\n<p>I decided on the latter because that pretty much solves my problem entirely without rearchitecting my (albeit small) application. Despite most of my website being static text; I reckon rendering all that on the server-side sounds like a problem for future Owen.</p>\n<h2 id=\"adding-an-api-route\">Adding an API route</h2>\n<p>Next step was to make a http request to the next.js backend for it to make an onward authenticated request with spotify. I create the following file at <code>src/app/pages/api/test.js</code>:</p>\n<div class=\"highlight\"><pre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"><code class=\"language-js\" data-lang=\"js\"><span style=\"color:#66d9ef\">export</span> <span style=\"color:#66d9ef\">default</span> <span style=\"color:#66d9ef\">function</span> <span style=\"color:#a6e22e\">handler</span>(<span style=\"color:#a6e22e\">req</span>, <span style=\"color:#a6e22e\">res</span>) {\n  <span style=\"color:#a6e22e\">res</span>.<span style=\"color:#a6e22e\">status</span>(<span style=\"color:#ae81ff\">200</span>).<span style=\"color:#a6e22e\">json</span>({ <span style=\"color:#a6e22e\">message</span><span style=\"color:#f92672\">:</span> <span style=\"color:#e6db74\">&#39;Hello from the backend!&#39;</span> })\n}\n</code></pre></div><p>Not so fast, computer says no:</p>\n<blockquote>\n<p>⨯ API Routes cannot be used with &ldquo;output: export&rdquo;. See more info here: <a href=\"https://nextjs.org/docs/advanced-features/static-html-export\">https://nextjs.org/docs/advanced-features/static-html-export</a></p>\n</blockquote>\n<p>Indeed, removing the <code>output: 'export'</code> in my <code>next.config.mjs</code> file sorted the issue. As much as I&rsquo;d love to tell you I had some well-founded reason for doing this other than just to get it to work, I&rsquo;m just trying to prove the concept at this page:\n<!-- raw HTML omitted --></p>\n<p>Now if my years of software engineering have tought me anything it&rsquo;s to be wary of making changes to files containing the word <code>config</code>, so I pushed the commit and checked I could still deploy the site. I had already checked I could deploy since the next.js migration, so this would prove that this change to the config file caused any potential issues. My hunch, sadly, paid off:\n<!-- raw HTML omitted --></p>\n<p>Serves me right for blindly changing things without understanding the implications of doing so. So what did I actually do, and how did this break the site? Let&rsquo;s compare the output directory when removing this from the config:</p>\n<!-- raw HTML omitted -->\n<p>LHS is with <code>output: 'export'</code>, RHS is without. Crucially, the left hand side has an <code>index.html</code>, which explains why previously the site would load without a <code>404</code>. Adding the following <code>netlify.toml</code> file resolved this issue for me:</p>\n<pre tabindex=\"0\"><code>[build]\n  command = &quot;npm run build&quot;\n  publish = &quot;.next&quot;\n\n[[plugins]]\n  package = &quot;@netlify/plugin-nextjs&quot;\n</code></pre><p>Hey presto, the API route is working on production:\n<!-- raw HTML omitted --></p>\n<p>Now I can replace this hello-world endpoint with an implementation to the spotify API, and my client-side just call my new API route without exposing any secrets:</p>\n<!-- raw HTML omitted -->\n<h2 id=\"final-touches\">Final touches</h2>\n<p>Now I&rsquo;ve got a working API route, with secrets nicely hidden. All that&rsquo;s left is to throw together some questionable CSS and get something pretty showing on my homepage. I won&rsquo;t go into the weeds of that, but you can <a href=\"https://owenlacey.dev\">take a look for yourself</a>:\n<!-- raw HTML omitted --></p>\n",
				"content_text": "\nI've recently found myself as a lead developer on a Next.js project. There's a .NET API that acts as the backend, which is much more within my comfort zone, but I'm definitely finding myself on the less-prepared side of things on the frontend.\n\nServer-side rendering has always been a bit mysterious to me: I struggle to properly grasp the benefit of something until I've got a use-case that's meaningful to me. With quite a lot of my experience being for business-facing enterprise web apps, the benefits Next.js adds are usually fairly low down on the priority list, so it was easier for me to dismiss it as just the latest fad in web development. Until recently.\n\nRecently, something clicked. Fairly often, I'd have have an idea for a personal project and due to my experience as a full-stack dev it's not long before I start thinking about things like databases & integrations. This is what usually stops me; when an idea becomes multiple executable applications, not to mention their own CI/CD requirements, it feels like too much hassle for me to do in my spare time. It was only when I considered a Next.js application like two separate applications, backend and frontend, rolled into one I immediately found a use case that I was excited about.\n\n## My use case\n\nI thought it would be cool for [my website](https://owenlacey.dev) to show what I'm currently listening to on spotify. From [their API docs](https://developer.spotify.com/documentation/web-api) it seemed like a relatively straightforward integration. When playing around with their sandbox I was horrified to learn that [Five Little Ducks](https://open.spotify.com/track/5HF2zdaYT7zpQGrkg1hP4v?si=a5ac0094429144c4) had made it into my top 5 songs of all time (don't have kids). All I needed to do was generate a client id / secret and start messing about with it, the only problem is I don't want to expose any secrets in my website.\n\nIn this case, it's quite easy to find the secrets by checking the network tab for network requests to the spotify API:\n<img src=\"uploads/2025/032189ae93.png\" alt=\"Screenshot of secret exposure via the network tab\">\nNow, I can't imagine you're going to do much more damage to my music library than my two-year-old currently is, but it still isn't good practice. I decided I'd migrate my React application to Next.js so that this integration could take place entirely on the server and I could keep my secrets just that: secret.\n\n## Migrating to Next.js\n[This guide](https://nextjs.org/docs/app/guides/migrating/from-vite) for migrating my app to Next.js took me about 30 minutes, the only obstacles I had here was fixing eslint errors introduced when following the guide. Because my CI/CD pipeline just does `npm run build`, I had my website migrated over to Next.js in no time. I've been developing long enough to know how rare it is for a migration to go this smoothly.\n\nJob done, right? No. Just because I've migrated my app to Next.js doesn't mean the necessary parts are server-side rendered. Indeed, those pesky token requests continued to happen because I bundled my whole `App` in the client using the `\"use client\"` directive.\n\n<img src=\"uploads/2025/a2d657ff16.png\" alt=\"Screenshot of use client directive\">\n\nI reached a fork in the road here where I felt I needed to choose between the following:\n1. Move the boundary between server and client to a higher level so I can be pickier about which components are rendered where. At the point of writing, the only responsive part of my application is related to the floating objects (see [here](https://blog.owenlacey.dev/2025/02/24/animated-images-on-my-website.html), and the 'fun fact' shuffle thing; the rest is just static text.\n1. Use server actions to make an authenticated request with spotify under the hood without exposing the configured secrets.\n\nI decided on the latter because that pretty much solves my problem entirely without rearchitecting my (albeit small) application. Despite most of my website being static text; I reckon rendering all that on the server-side sounds like a problem for future Owen.\n\n## Adding an API route\n\nNext step was to make a http request to the next.js backend for it to make an onward authenticated request with spotify. I create the following file at `src/app/pages/api/test.js`:\n```js\nexport default function handler(req, res) {\n  res.status(200).json({ message: 'Hello from the backend!' })\n}\n```\nNot so fast, computer says no:\n> ⨯ API Routes cannot be used with \"output: export\". See more info here: https://nextjs.org/docs/advanced-features/static-html-export\n\nIndeed, removing the `output: 'export'` in my `next.config.mjs` file sorted the issue. As much as I'd love to tell you I had some well-founded reason for doing this other than just to get it to work, I'm just trying to prove the concept at this page:\n<img src=\"uploads/2025/c81bcbff47.png\" alt=\"working API route\">\n\nNow if my years of software engineering have tought me anything it's to be wary of making changes to files containing the word `config`, so I pushed the commit and checked I could still deploy the site. I had already checked I could deploy since the next.js migration, so this would prove that this change to the config file caused any potential issues. My hunch, sadly, paid off:\n<img src=\"uploads/2025/2242668945.png\" alt=\"404 on my site\">\n\nServes me right for blindly changing things without understanding the implications of doing so. So what did I actually do, and how did this break the site? Let's compare the output directory when removing this from the config:\n\n<img src=\"uploads/2025/091293b5fa.png\" alt=\"output comparison based on config changes\">\n\nLHS is with `output: 'export'`, RHS is without. Crucially, the left hand side has an `index.html`, which explains why previously the site would load without a `404`. Adding the following `netlify.toml` file resolved this issue for me:\n```\n[build]\n  command = \"npm run build\"\n  publish = \".next\"\n\n[[plugins]]\n  package = \"@netlify/plugin-nextjs\"\n```\nHey presto, the API route is working on production:\n<img src=\"uploads/2025/7867a6b184.png\" alt=\"API route in prod\">\n\nNow I can replace this hello-world endpoint with an implementation to the spotify API, and my client-side just call my new API route without exposing any secrets:\n\n<img src=\"uploads/2025/05871c6c40.png\" alt=\"Next.js calling the new API route\">\n\n## Final touches\n\nNow I've got a working API route, with secrets nicely hidden. All that's left is to throw together some questionable CSS and get something pretty showing on my homepage. I won't go into the weeds of that, but you can [take a look for yourself](https://owenlacey.dev):\n<img src=\"uploads/2025/a3dc2e2d21.png\" alt=\"Now playing in action on my site.\">\n\n\n",
				"date_published": "2025-05-08T21:19:26+01:00",
				"url": "https://blog.owenlacey.dev/2025/04/28/nextjs.html",
				"tags": ["I did a thing"]
			},
			{
				"id": "http://owenlacey.micro.blog/2025/04/15/173338.html",
				"title": "I made an AI Sudoku Solver",
				"content_html": "<h1 id=\"introduction\">Introduction</h1>\n<p>I regularly use Sudokus as a Hello World use case for what you can use <a href=\"https://developers.google.com/optimization/\">Google OR Tools</a> for. I decided to take it a few steps further to see if I could create an end-to-end solution for solving a Sudoku in the quickest way possible. I wanted to expand my OR Tools Sudoku solver into an AI pipeline, where the OR Tools implementation is one part of a string of events to solve a Sudoku pretty much instantly.</p>\n<p>I&rsquo;m by no means a trailblazer here. If you google &ldquo;Sudoku solver&rdquo; or similar, you&rsquo;ll see loads of results that are all pretty much doing the same thing. In fact, the code for parts of the problem are (shamelessley plagiarised) based upon this <a href=\"https://github.com/atomic14/ar-browser-sudoku/\">github repo</a>. I would also recommend watching <a href=\"https://www.youtube.com/watch?v=x-HH0kwbO-4\">this youtube video</a> where the author goes into detail about how he approached this problem, which I found really interesting.</p>\n<p>You can find the code for my implementation <a href=\"https://github.com/owen-lacey/auto-sudoku\">here</a>, feel free to try out the app for yourself as well <a href=\"https://auto-sudoku.azurewebsites.net/\">here</a>!</p>\n<p>Here&rsquo;s a quick demo in its current state:</p>\n<p><!-- raw HTML omitted --><!-- raw HTML omitted --></p>\n<h1 id=\"breaking-down-the-problem\">Breaking down the problem</h1>\n<p>I decided to break my problem down into three stages:</p>\n<ol>\n<li>Sudoku detection: given an image, return at most 1 Sudoku present in the image.</li>\n<li>Digit OCR: sub-divide the Soduku into the 81 cells that make up the 9x9 grid, and run OCR to find what digits are already there.</li>\n<li>Send the unsolved Sudoku to Google OR Tools and show the solution to the user (ideally with a sexy CSS animation).</li>\n</ol>\n<p>Breaking it down like this allowed me to solve each part in isolation, using the most appropriate solution for each stage. Here&rsquo;s a visual breakdown of what I&rsquo;m doing in each step:</p>\n<!-- raw HTML omitted -->\n<h2 id=\"sudoku-detection\">Sudoku detection</h2>\n<p>At the end of this stage, the aim is to have a region representing a sudoku. I could have used many different approaches here, and it might surprise you to learn that I didn&rsquo;t even go with an AI-based solution for this stage. I tried to train my own object detection model, but it performed really poorly. As obvious as it seems in retrospect, the only thing any two sudoku puzzles have in common is the 9x9 grid containing the digits for that specific puzzle. I wouldn&rsquo;t describe myself as an expert in training object detection models so perhaps I could have persevered here, but the amount of false-positives I got from my model made me crawl back to the drawing board. This was a nice refresher for me that AI isn&rsquo;t always just magic, and sometimes pulling your sleeves up and doing it manually is the best (and possibly most rewarding) approach.</p>\n<p>That being said, a manual approach has its drawbacks as well. For example, my approach doesn&rsquo;t handle sudokus in dark theme, nor would it be able to find a sudoku if its border happened to be dotted or dashed. It works brilliantly on my £1.99 puzzle book I bought from Asda, and that&rsquo;s good enough for me.</p>\n<p>Now, into the approach. Put simply, we need to find the biggest square in a given image. This doesn&rsquo;t need to be a perfect square, as it would be practically impossible for a human to take a photo of a sudoku such that the area it takes up on the image is perfectly square. We&rsquo;ll therefore add tolerances to sanity check what the application thinks might be a square rather than checking that the <code>height = width</code> exactly.</p>\n<p>To find our square, we&rsquo;ll iterate through the pixels on the image. For each pixel, we&rsquo;ll return all the other pixels which are &ldquo;connected&rdquo; to it i.e there exists a path between the pixels such that all pixels along the path are the same colour (the same hex code). Our square is the largest connected region that lies within the tolerances mentioned above. This presents a problem in that, to the naked eye, two pixels that look the same colour are very likely to have a different hex code. We therefore need to apply a process called <em>adaptive thresholding</em>, which is where we reduce our image into one such that each pixel is one of two colours: white or black. This polarisation of pixels allows us to find a collection of points of all the same colour on the thresholded image that are most likely to contain a sudoku. Here&rsquo;s what an image of a sudoku looks like when adaptive thresholding is applied:</p>\n<p><img src=\"https://blog.owenlacey.dev/uploads/2025/3-thresholded.png\" alt=\"Thresholded sudoku\"></p>\n<p>Looking at this image, it&rsquo;s easy to see what the largest number of white connected pixels would be, and that&rsquo;s exactly what our program was able to find.</p>\n<p>At this point, we have a region containing a sudoku. However, there&rsquo;s a need for this region to be square so we can easily divide it into smaller squares where we can expect to find a digit. If we were to subdivide this image now, it would look for digits in the wrong place. Here&rsquo;s an image of me sub-dividing this regions manually to illustrate that point:</p>\n<!-- raw HTML omitted -->\n<p>We need to transform our image into a square. Specifically, this needs to be a <em>homographic transform</em>. Once we have our transform, we can construct a new image that&rsquo;s perfectly square and ready to sub-divide.</p>\n<!-- raw HTML omitted -->\n<p>The first step is to find what we think are the corners of our sudoku. To do this, for each corner, we find the closes point to it using <a href=\"https://en.wikipedia.org/wiki/Taxicab_geometry\">manhattan distance</a>. I added a bit of padding to the region to illustrate how manhattan distance works:</p>\n<!-- raw HTML omitted -->\n<p>We need to map these four points onto the corners of a square. This is where we can get pretty deep into the maths of it all, but for brevity you can determine the homographic transform using <a href=\"https://web.archive.org/web/20071214081425/http://alumni.media.mit.edu/~cwren/interpolator/\">this guide</a> (note, I used <a href=\"https://mathjs.org/\">mathjs</a> for the matrix operations). Once we&rsquo;ve got the transform we can show our sudoku as a square, ready for further processing.</p>\n<!-- raw HTML omitted -->\n<h2 id=\"digit-ocr\">Digit OCR</h2>\n<p>Now we&rsquo;ve got a Sudoku, we need to be able to say what existing digits are there so we can solve the remainder of the puzzle in stage 3. Firstly, we need to find which cells contain a digit so that we can process the sub-image and determine what digit is in the cell. For this stage, I went with a <a href=\"https://github.com/atomic14/ar-browser-sudoku/tree/master/tensorflow\">pre-trained tensorflow model</a>.</p>\n<!-- raw HTML omitted -->\n<p>Once sub-divided, we can re-use the code in stage 1 to return the largest connected region of each cell. We can again use tolerances to ensure we flag a cell as containing a digit if the found region is of a large enough size (again, no AI yet).</p>\n<p>At this point, all the AI can take place in the browser thanks to the magic of <a href=\"https://www.tensorflow.org/js\">tensorflowjs</a>.  Now, this model isn&rsquo;t mine, it was made by the same person who I linked in the introduction of the post. One thing that surprised me was how lightweight an AI model can be. So lightweight infact that you can even bundle it in your application and use it directly in the browser, and that&rsquo;s exactly what I did:</p>\n<!-- raw HTML omitted -->\n<p>If you didn&rsquo;t know already, you can find a heap of pre-trained models online in <a href=\"https://tfhub.dev/\">TensorFlow Hub</a>. I tried a few models which matched the search term &ldquo;digit recogniser&rdquo;, but this one worked the best.</p>\n<h2 id=\"solve-the-sudoku\">Solve the Sudoku</h2>\n<p>Right, I&rsquo;ve used the AI buzzword now - I can get onto my favourite bit: OR Tools. To save me re-introducing it every post, I give a summary of what it is <a href=\"https://blog.owenlacey.dev/2025/02/22/building-probably-the-best-fpl.html\">here</a>. Because there is always exactly one solution to a Sudoku we can&rsquo;t brand this as an optimisation problem, but it&rsquo;s a great example of finding the single <em>feasible</em> solution from a high number of <em>infeasible</em> ones.</p>\n<p>Now we have a digital representation of a sudoku, I can create a variable for each blank cell with possible values of all integers between 1 to 9, and with just a few more lines of code, let OR Tools do the rest.</p>\n<!-- raw HTML omitted -->\n<p>Circling back to what I said at the top of this post - this thing needs to be <em>fast</em>. Here&rsquo;s how quick it is for an expert level sudoku:</p>\n<!-- raw HTML omitted -->\n<h1 id=\"wrapping-up\">Wrapping up</h1>\n<p>What started as a simple &ldquo;Hello World&rdquo; demo with OR Tools turned into a really rewarding journey in a completely new area for me in image processing techniques. My main takeaway is that just because you <em>can</em> use AI to solve a problem doesn&rsquo;t mean you <em>should</em> - manual methods still have their place, especially when they just work.</p>\n<p>It’s definitely not perfect, but it was great fun to build—and I learned loads doing it. If you want to try it out yourself or poke around the code, you can find all the links you need at the top. Thanks for reading!</p>\n",
				"content_text": "# Introduction\n\nI regularly use Sudokus as a Hello World use case for what you can use [Google OR Tools](https://developers.google.com/optimization/) for. I decided to take it a few steps further to see if I could create an end-to-end solution for solving a Sudoku in the quickest way possible. I wanted to expand my OR Tools Sudoku solver into an AI pipeline, where the OR Tools implementation is one part of a string of events to solve a Sudoku pretty much instantly.\n\nI'm by no means a trailblazer here. If you google \"Sudoku solver\" or similar, you'll see loads of results that are all pretty much doing the same thing. In fact, the code for parts of the problem are (shamelessley plagiarised) based upon this [github repo](https://github.com/atomic14/ar-browser-sudoku/). I would also recommend watching [this youtube video](https://www.youtube.com/watch?v=x-HH0kwbO-4) where the author goes into detail about how he approached this problem, which I found really interesting.\n\nYou can find the code for my implementation [here](https://github.com/owen-lacey/auto-sudoku), feel free to try out the app for yourself as well [here](https://auto-sudoku.azurewebsites.net/)!\n\nHere's a quick demo in its current state:\n\n<video src=\"https://blog.owenlacey.dev/uploads/2025/25-04-14-13-02-13.mp4\" controls=\"controls\" preload=\"metadata\"></video>\n\n# Breaking down the problem\n\nI decided to break my problem down into three stages:\n1. Sudoku detection: given an image, return at most 1 Sudoku present in the image.\n1. Digit OCR: sub-divide the Soduku into the 81 cells that make up the 9x9 grid, and run OCR to find what digits are already there.\n1. Send the unsolved Sudoku to Google OR Tools and show the solution to the user (ideally with a sexy CSS animation).\n\nBreaking it down like this allowed me to solve each part in isolation, using the most appropriate solution for each stage. Here's a visual breakdown of what I'm doing in each step:\n\n<img src=\"uploads/2025/f164ec3281.png\" alt=\"A visual breakdown of auto-sudoku\">\n\n## Sudoku detection\n\nAt the end of this stage, the aim is to have a region representing a sudoku. I could have used many different approaches here, and it might surprise you to learn that I didn't even go with an AI-based solution for this stage. I tried to train my own object detection model, but it performed really poorly. As obvious as it seems in retrospect, the only thing any two sudoku puzzles have in common is the 9x9 grid containing the digits for that specific puzzle. I wouldn't describe myself as an expert in training object detection models so perhaps I could have persevered here, but the amount of false-positives I got from my model made me crawl back to the drawing board. This was a nice refresher for me that AI isn't always just magic, and sometimes pulling your sleeves up and doing it manually is the best (and possibly most rewarding) approach.\n\nThat being said, a manual approach has its drawbacks as well. For example, my approach doesn't handle sudokus in dark theme, nor would it be able to find a sudoku if its border happened to be dotted or dashed. It works brilliantly on my £1.99 puzzle book I bought from Asda, and that's good enough for me.\n\nNow, into the approach. Put simply, we need to find the biggest square in a given image. This doesn't need to be a perfect square, as it would be practically impossible for a human to take a photo of a sudoku such that the area it takes up on the image is perfectly square. We'll therefore add tolerances to sanity check what the application thinks might be a square rather than checking that the `height = width` exactly.\n\nTo find our square, we'll iterate through the pixels on the image. For each pixel, we'll return all the other pixels which are \"connected\" to it i.e there exists a path between the pixels such that all pixels along the path are the same colour (the same hex code). Our square is the largest connected region that lies within the tolerances mentioned above. This presents a problem in that, to the naked eye, two pixels that look the same colour are very likely to have a different hex code. We therefore need to apply a process called _adaptive thresholding_, which is where we reduce our image into one such that each pixel is one of two colours: white or black. This polarisation of pixels allows us to find a collection of points of all the same colour on the thresholded image that are most likely to contain a sudoku. Here's what an image of a sudoku looks like when adaptive thresholding is applied:\n\n![Thresholded sudoku](https://blog.owenlacey.dev/uploads/2025/3-thresholded.png)\n\nLooking at this image, it's easy to see what the largest number of white connected pixels would be, and that's exactly what our program was able to find.\n\nAt this point, we have a region containing a sudoku. However, there's a need for this region to be square so we can easily divide it into smaller squares where we can expect to find a digit. If we were to subdivide this image now, it would look for digits in the wrong place. Here's an image of me sub-dividing this regions manually to illustrate that point:\n\n<img src=\"uploads/2025/d25317cb59.png\" alt=\"poorly subdivided sudoku\">\n\nWe need to transform our image into a square. Specifically, this needs to be a _homographic transform_. Once we have our transform, we can construct a new image that's perfectly square and ready to sub-divide. \n\n<img src=\"uploads/2025/0c702ac0a2.png\" alt=\"Visualisation of a homographic transform\">\n\nThe first step is to find what we think are the corners of our sudoku. To do this, for each corner, we find the closes point to it using [manhattan distance](https://en.wikipedia.org/wiki/Taxicab_geometry). I added a bit of padding to the region to illustrate how manhattan distance works:\n\n<img src=\"uploads/2025/ed36fe21bb.png\" alt=\"Sudoku corners manhattan distance\">\n\nWe need to map these four points onto the corners of a square. This is where we can get pretty deep into the maths of it all, but for brevity you can determine the homographic transform using [this guide](https://web.archive.org/web/20071214081425/http://alumni.media.mit.edu/~cwren/interpolator/) (note, I used [mathjs](https://mathjs.org/) for the matrix operations). Once we've got the transform we can show our sudoku as a square, ready for further processing.\n\n<img src=\"uploads/2025/51bcc57431.png\" alt=\"transformed sudoku\">\n\n## Digit OCR\n\nNow we've got a Sudoku, we need to be able to say what existing digits are there so we can solve the remainder of the puzzle in stage 3. Firstly, we need to find which cells contain a digit so that we can process the sub-image and determine what digit is in the cell. For this stage, I went with a [pre-trained tensorflow model](https://github.com/atomic14/ar-browser-sudoku/tree/master/tensorflow).\n\n<img src=\"uploads/2025/d5c0c44337.png\" alt=\"Digit detection breakdown\">\n\nOnce sub-divided, we can re-use the code in stage 1 to return the largest connected region of each cell. We can again use tolerances to ensure we flag a cell as containing a digit if the found region is of a large enough size (again, no AI yet).\n\nAt this point, all the AI can take place in the browser thanks to the magic of [tensorflowjs](https://www.tensorflow.org/js).  Now, this model isn't mine, it was made by the same person who I linked in the introduction of the post. One thing that surprised me was how lightweight an AI model can be. So lightweight infact that you can even bundle it in your application and use it directly in the browser, and that's exactly what I did:\n\n<img src=\"uploads/2025/ab306081ba.png\" alt=\"Me loading the model in the browser\">\n\nIf you didn't know already, you can find a heap of pre-trained models online in [TensorFlow Hub](https://tfhub.dev/). I tried a few models which matched the search term \"digit recogniser\", but this one worked the best.\n\n## Solve the Sudoku\n\nRight, I've used the AI buzzword now - I can get onto my favourite bit: OR Tools. To save me re-introducing it every post, I give a summary of what it is [here](https://blog.owenlacey.dev/2025/02/22/building-probably-the-best-fpl.html). Because there is always exactly one solution to a Sudoku we can't brand this as an optimisation problem, but it's a great example of finding the single _feasible_ solution from a high number of _infeasible_ ones.\n\nNow we have a digital representation of a sudoku, I can create a variable for each blank cell with possible values of all integers between 1 to 9, and with just a few more lines of code, let OR Tools do the rest.\n\n<img src=\"uploads/2025/5daf515111.png\" alt=\"Sudoku solver in code\">\n\nCircling back to what I said at the top of this post - this thing needs to be _fast_. Here's how quick it is for an expert level sudoku:\n\n<img src=\"uploads/2025/ecc0d44e0d.png\" alt=\"Sudoku solving performance\">\n\n# Wrapping up\n\nWhat started as a simple \"Hello World\" demo with OR Tools turned into a really rewarding journey in a completely new area for me in image processing techniques. My main takeaway is that just because you _can_ use AI to solve a problem doesn't mean you _should_ - manual methods still have their place, especially when they just work. \r\n\r\nIt’s definitely not perfect, but it was great fun to build—and I learned loads doing it. If you want to try it out yourself or poke around the code, you can find all the links you need at the top. Thanks for reading!\n",
				"date_published": "2025-04-22T22:10:36+01:00",
				"url": "https://blog.owenlacey.dev/2025/04/15/173338.html",
				"tags": ["I did a thing"]
			},
			{
				"id": "http://owenlacey.micro.blog/2025/03/19/switching-off-my-consultancy-brain.html",
				"title": "Switching off my consultancy brain",
				"content_html": "<p>Last week I did something scary. I left a job that I loved after 8 years for something different - a fresh challenge. From what I hear, it&rsquo;s pretty common for people to take some time off work between jobs by using up remaining annual leave or taking some time unpaid. I&rsquo;m no exception here; I&rsquo;m currently half-way through my self-proclaimed &ldquo;micro-sabbatical&rdquo; of 10 whole days, and it&rsquo;s brutal.</p>\n<p>During my notice period, I built up a list of things I wanted to get done during this week-and-a-bit. Like all good software projects, this list is a backlog of musts/shoulds/coulds. I &ldquo;must&rdquo; make a plan for Mothers' day, I &ldquo;could&rdquo; fix the under-counter lights in the kitchen. My wife and I are blessed with a bouncy two year old (Reuben), and we blessed ourselves almost 7 years ago by getting a dog (Toby). Though very much self-inflicted, these dependents meant my free time was suddenly at a premium.</p>\n<!-- raw HTML omitted -->\n<p>I&rsquo;m sure you don&rsquo;t have much sympathy for this situation (I don&rsquo;t either - stop whining, Owen); I&rsquo;ve loved taking Reuben and Toby on adventures this week, but I took me less than half a day into my micro-sabbatical to realise this list isn&rsquo;t going to get done. After 8 years of deadlines where time is king, I felt myself wanting to update someone on my progress to manage their expectations. I was half an hour late picking up my wife from work on Monday for the simple reason that I just wanted to have a cup of tea that I hadn&rsquo;t given myself chance to have yet. Yesterday, after a morning of manual labour in the garden, my hairdresser said I looked shattered and prescribed me a nap when I got home. Did I take a nap? Don&rsquo;t be stupid. I hope no-one from my new work is reading this, but I&rsquo;m arguably working harder than I was last week when I was getting paid for it.</p>\n<p>There&rsquo;s a difference between &ldquo;free time&rdquo; and &ldquo;alone time&rdquo;, and this has become a chasm since having kids. My wife said herself that her productivity in her free time has massively increased in the last two years; she&rsquo;s like a whirlwind the second he goes down for a nap. It&rsquo;s almost like you need to have time taken away from you for you to realise how you want to spend it.</p>\n<p>Today is Wednesday and I&rsquo;m going to try take things a bit slower. Things like writing this post is a good example of a &ldquo;could&rdquo; that I&rsquo;m proud of myself for doing. In fact, this wasn&rsquo;t even in the backlog, talk about scope creep! This weekend I&rsquo;m going to London to visit some good friends ahead of starting at my new place on Monday. Between now and then, I hope to indulge myself further.</p>\n",
				"content_text": "Last week I did something scary. I left a job that I loved after 8 years for something different - a fresh challenge. From what I hear, it's pretty common for people to take some time off work between jobs by using up remaining annual leave or taking some time unpaid. I'm no exception here; I'm currently half-way through my self-proclaimed \"micro-sabbatical\" of 10 whole days, and it's brutal.\n\nDuring my notice period, I built up a list of things I wanted to get done during this week-and-a-bit. Like all good software projects, this list is a backlog of musts/shoulds/coulds. I \"must\" make a plan for Mothers' day, I \"could\" fix the under-counter lights in the kitchen. My wife and I are blessed with a bouncy two year old (Reuben), and we blessed ourselves almost 7 years ago by getting a dog (Toby). Though very much self-inflicted, these dependents meant my free time was suddenly at a premium. \n\n<img src=\"uploads/2025/b48b5cdcf8.png\" alt=\"Toby, Fliss and I\">\n\nI'm sure you don't have much sympathy for this situation (I don't either - stop whining, Owen); I've loved taking Reuben and Toby on adventures this week, but I took me less than half a day into my micro-sabbatical to realise this list isn't going to get done. After 8 years of deadlines where time is king, I felt myself wanting to update someone on my progress to manage their expectations. I was half an hour late picking up my wife from work on Monday for the simple reason that I just wanted to have a cup of tea that I hadn't given myself chance to have yet. Yesterday, after a morning of manual labour in the garden, my hairdresser said I looked shattered and prescribed me a nap when I got home. Did I take a nap? Don't be stupid. I hope no-one from my new work is reading this, but I'm arguably working harder than I was last week when I was getting paid for it.\n\nThere's a difference between \"free time\" and \"alone time\", and this has become a chasm since having kids. My wife said herself that her productivity in her free time has massively increased in the last two years; she's like a whirlwind the second he goes down for a nap. It's almost like you need to have time taken away from you for you to realise how you want to spend it.\n\nToday is Wednesday and I'm going to try take things a bit slower. Things like writing this post is a good example of a \"could\" that I'm proud of myself for doing. In fact, this wasn't even in the backlog, talk about scope creep! This weekend I'm going to London to visit some good friends ahead of starting at my new place on Monday. Between now and then, I hope to indulge myself further.\n",
				"date_published": "2025-03-19T11:18:11+01:00",
				"url": "https://blog.owenlacey.dev/2025/03/19/switching-off-my-consultancy-brain.html",
				"tags": ["Personal"]
			},
			{
				"id": "http://owenlacey.micro.blog/2025/02/24/animated-images-on-my-website.html",
				"title": "I over-engineered my website's personalisation",
				"content_html": "<h1 id=\"introduction\">Introduction</h1>\n<p>A recent milestone for me is finally putting together <a href=\"https://owenlacey.dev\">my personal website</a>. Though I&rsquo;m not expecting this website to be much more than a pointer to where else you might find me, I wanted it to show my personality and to give some examples of things I find inspiring.</p>\n<p>If you&rsquo;ve checked out the website, you&rsquo;ll have noticed the floating icons distracting you from from the content I&rsquo;ve put on the site. I don&rsquo;t care, they&rsquo;re far cooler than anything I would have to say. These, if you didn&rsquo;t know, are called <em>penrose triangles</em>:</p>\n<!-- raw HTML omitted -->\n<p>These triangles are impossible in euclidean geometry, and are the sort of optical illusions that might remind you of the artist Escher&rsquo;s work. For me, they are the simplest way to make your head spin using just a pen &amp; paper; if you&rsquo;ve spotted me doodling in meetings (me? never!), I&rsquo;m probably drawing some of these - I think they&rsquo;re brilliant.</p>\n<h1 id=\"how-i-did-this\">How I did this</h1>\n<p>Enough nerding out. After all, the point of this post is to go through how I added them to my site. More specifically, how I made them do that stuff with pure CSS. Here&rsquo;s a quick overview of my approach:</p>\n<ol>\n<li>I made the triangles myself on procreate. I enjoy messing around on the family iPad, and figured it might come in handy having these assets in future.</li>\n<li>I used SASS for styling, which compiles into CSS, so that I can utilise various <a href=\"https://sass-lang.com/documentation/at-rules/\">At-Rules</a> to make this CSS-only.</li>\n<li>Penrose triangles aren&rsquo;t the only thing I find cool, so I wanted the app to iterate through all the floating icons that might be bundled in my app and randomly decide on an amount of them to use. This way, I might have time to create some Möbius strips, Rubiks cubes, Poké Balls, whatever.</li>\n</ol>\n<p>I wanted the icons to idly float around the background of my website in random directions. At the same time, I didn&rsquo;t want my website to be full of loads of hacky javascript code, so I thought it would be fun to try and do this in <em>pure CSS</em>. Without the benefit of hindsight I decided to name these icons <code>Floater</code>s; something I now regret. Regardless, it reminds me of one of my favourite quotes:</p>\n<blockquote>\n<p><em>There are only two hard things in Computer Science: cache invalidation and naming things - Phil Karlton</em></p>\n</blockquote>\n<p>With my consultancy hat on, here was my acceptance criteria:</p>\n<ol>\n<li>Icons are randomly positioned on the page.</li>\n<li>Icons float around in random directions.</li>\n<li>Icons have a random degree of rotation.</li>\n</ol>\n<p>First, I wanted to prove the concept. I needed to prove that I could apply custom behaviour to each icon without writing massive amounts of duplicated CSS. I know that I have tabs on the <code>index</code> (a unique identifier) when iterating through the <code>Floater</code>s, but how do I pass that through to the styles? I&rsquo;m not much of a front-end developer, but I like using the <a href=\"https://css-tricks.com/bem-101/\">BEM methodology </a> for styles so that my DOM looks like the below:</p>\n<!-- raw HTML omitted -->\n<p>Now that each <code>Floater</code> has its own unique class name, I can style them differently. I can also use <code>@for</code> so that I don&rsquo;t have to duplicate the styles for each one:</p>\n<div class=\"highlight\"><pre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"><code class=\"language-scss\" data-lang=\"scss\"><span style=\"color:#a6e22e\">.floater</span> {\n  $n<span style=\"color:#f92672\">:</span> <span style=\"color:#ae81ff\">5</span>;\n  <span style=\"color:#66d9ef\">@for</span> $i <span style=\"color:#f92672\">from</span> <span style=\"color:#ae81ff\">0</span> <span style=\"color:#f92672\">through</span> $n {\n    <span style=\"color:#66d9ef\">&amp;</span><span style=\"color:#f92672\">--</span><span style=\"color:#e6db74\">#{</span>$i<span style=\"color:#e6db74\">}</span> {\n      <span style=\"color:#a6e22e\">height</span><span style=\"color:#f92672\">:</span> <span style=\"color:#ae81ff\">60</span><span style=\"color:#66d9ef\">px</span> <span style=\"color:#f92672\">+</span> $i <span style=\"color:#f92672\">*</span> <span style=\"color:#ae81ff\">20</span><span style=\"color:#66d9ef\">px</span>;\n    }\n  }\n}\n</code></pre></div><p>This means that each consecutive <code>Floater</code> gets bigger by <code>20px</code>, like so:</p>\n<!-- raw HTML omitted -->\n<p>Now we know we can style them differently, that means each <code>Floater</code> can have its own <em>animation</em>. Let&rsquo;s start small; simply moving up and down:</p>\n<div class=\"highlight\"><pre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"><code class=\"language-scss\" data-lang=\"scss\">  $n<span style=\"color:#f92672\">:</span> <span style=\"color:#ae81ff\">9</span>;\n  <span style=\"color:#66d9ef\">@for</span> $i <span style=\"color:#f92672\">from</span> <span style=\"color:#ae81ff\">0</span> <span style=\"color:#f92672\">through</span> $n {\n    <span style=\"color:#66d9ef\">@keyframes</span> <span style=\"color:#f92672\">floater</span><span style=\"color:#e6db74\">#{</span>$i<span style=\"color:#e6db74\">}</span> {\n      <span style=\"color:#f92672\">0</span><span style=\"color:#960050;background-color:#1e0010\">%</span> {\n        <span style=\"color:#a6e22e\">transform</span><span style=\"color:#f92672\">:</span> <span style=\"color:#a6e22e\">translateY</span>(<span style=\"color:#ae81ff\">0</span>);\n      }\n      <span style=\"color:#f92672\">50</span><span style=\"color:#960050;background-color:#1e0010\">%</span> {\n        <span style=\"color:#a6e22e\">transform</span><span style=\"color:#f92672\">:</span> <span style=\"color:#a6e22e\">translateY</span>(<span style=\"color:#ae81ff\">10</span> <span style=\"color:#f92672\">*</span> ($i<span style=\"color:#f92672\">+</span><span style=\"color:#ae81ff\">1</span>) <span style=\"color:#f92672\">+</span> px);\n      }\n      <span style=\"color:#f92672\">100</span><span style=\"color:#960050;background-color:#1e0010\">%</span> {\n        <span style=\"color:#a6e22e\">transform</span><span style=\"color:#f92672\">:</span> <span style=\"color:#a6e22e\">translateY</span>(<span style=\"color:#ae81ff\">0</span>);\n      }\n    }\n    <span style=\"color:#66d9ef\">&amp;</span><span style=\"color:#f92672\">--</span><span style=\"color:#e6db74\">#{</span>$i<span style=\"color:#e6db74\">}</span> {\n      <span style=\"color:#a6e22e\">animation</span><span style=\"color:#f92672\">:</span> floater<span style=\"color:#e6db74\">#{</span>$i<span style=\"color:#e6db74\">}</span> <span style=\"color:#ae81ff\">1</span><span style=\"color:#66d9ef\">s</span> ease alternate infinite;\n    }\n  }\n</code></pre></div><p>This means that each consecutive <code>Floater</code> moves down 10 more pixels:</p>\n<p><img src=\"https://blog.owenlacey.dev/uploads/2025/chrome-f5iy1k4igh.gif\" alt=\"bouncing triangles\"></p>\n<p>This was the final thing I needed to do to prove the concept. Now to actually make it look good&hellip;</p>\n<h2 id=\"random-positioning\">Random positioning</h2>\n<p>I decided to use <a href=\"https://sass-lang.com/documentation/at-rules/mixin/\">mixins</a> to keep the styles within the class declaration nice and succinct. Here&rsquo;s a <code>mixin</code> for random positioning:</p>\n<div class=\"highlight\"><pre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"><code class=\"language-scss\" data-lang=\"scss\"><span style=\"color:#66d9ef\">@mixin</span><span style=\"color:#a6e22e\"> random-position</span> {\n  <span style=\"color:#a6e22e\">position</span><span style=\"color:#f92672\">:</span> absolute;\n  <span style=\"color:#a6e22e\">left</span><span style=\"color:#f92672\">:</span> <span style=\"color:#a6e22e\">random</span>(<span style=\"color:#ae81ff\">100</span>) <span style=\"color:#f92672\">+</span> vw;\n  <span style=\"color:#a6e22e\">top</span><span style=\"color:#f92672\">:</span> <span style=\"color:#a6e22e\">random</span>(<span style=\"color:#ae81ff\">100</span>) <span style=\"color:#f92672\">+</span> vh;\n}\n\n<span style=\"color:#a6e22e\">.floater</span> {\n  $n<span style=\"color:#f92672\">:</span> <span style=\"color:#ae81ff\">200</span>;\n  <span style=\"color:#66d9ef\">@for</span> $i <span style=\"color:#f92672\">from</span> <span style=\"color:#ae81ff\">0</span> <span style=\"color:#f92672\">through</span> $n {\n\n    <span style=\"color:#66d9ef\">&amp;</span><span style=\"color:#f92672\">--</span><span style=\"color:#e6db74\">#{</span>$i<span style=\"color:#e6db74\">}</span> {\n      <span style=\"color:#66d9ef\">@include</span><span style=\"color:#a6e22e\"> random-position</span>;\n    }\n  }\n}\n</code></pre></div><p>This uses <a href=\"https://sass-lang.com/documentation/modules/math/#random\">random</a> to give each <code>Floater</code> a random <code>left</code> and <code>top</code>. This dotted the <code>Floater</code>s around nicely like so:</p>\n<!-- raw HTML omitted -->\n<h2 id=\"random-spin\">Random spin</h2>\n<p>Here&rsquo;s the code to make the <code>Floater</code>s spin:</p>\n<div class=\"highlight\"><pre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"><code class=\"language-scss\" data-lang=\"scss\"><span style=\"color:#66d9ef\">@mixin</span><span style=\"color:#a6e22e\"> spin-animation</span>($i<span style=\"color:#f92672\">,</span> $initialRotate) {\n  <span style=\"color:#66d9ef\">@keyframes</span> <span style=\"color:#f92672\">spin</span><span style=\"color:#e6db74\">#{</span>$i<span style=\"color:#e6db74\">}</span> {\n    <span style=\"color:#f92672\">0</span><span style=\"color:#960050;background-color:#1e0010\">%</span> {\n      <span style=\"color:#a6e22e\">transform</span><span style=\"color:#f92672\">:</span> <span style=\"color:#a6e22e\">rotate</span>($initialRotate <span style=\"color:#f92672\">+</span> deg);\n    }\n    <span style=\"color:#f92672\">100</span><span style=\"color:#960050;background-color:#1e0010\">%</span> {\n      <span style=\"color:#a6e22e\">transform</span><span style=\"color:#f92672\">:</span> <span style=\"color:#a6e22e\">rotate</span>($initialRotate <span style=\"color:#f92672\">+</span> <span style=\"color:#ae81ff\">360</span><span style=\"color:#66d9ef\">deg</span>);\n    }\n  }\n}\n\n<span style=\"color:#a6e22e\">.floater</span> {\n  $n<span style=\"color:#f92672\">:</span> <span style=\"color:#ae81ff\">200</span>;\n  <span style=\"color:#66d9ef\">@for</span> $i <span style=\"color:#f92672\">from</span> <span style=\"color:#ae81ff\">0</span> <span style=\"color:#f92672\">through</span> $n {\n    <span style=\"color:#66d9ef\">@include</span><span style=\"color:#a6e22e\"> spin-animation</span>($i<span style=\"color:#f92672\">,</span> $initialRotate);\n    <span style=\"color:#66d9ef\">&amp;</span><span style=\"color:#f92672\">--</span><span style=\"color:#e6db74\">#{</span>$i<span style=\"color:#e6db74\">}</span> {\n      <span style=\"color:#66d9ef\">@include</span><span style=\"color:#a6e22e\"> random-position</span>; <span style=\"color:#75715e\">// as before\n</span><span style=\"color:#75715e\"></span>\n      <span style=\"color:#f92672\">&gt;</span> <span style=\"color:#f92672\">img</span> {\n        <span style=\"color:#a6e22e\">transform-origin</span><span style=\"color:#f92672\">:</span> top left;\n        <span style=\"color:#a6e22e\">animation</span><span style=\"color:#f92672\">:</span> spin<span style=\"color:#e6db74\">#{</span>$i<span style=\"color:#e6db74\">}</span> <span style=\"color:#ae81ff\">30</span><span style=\"color:#66d9ef\">s</span> linear infinite;\n      }\n    }\n  }\n}\n</code></pre></div><p>I went with this because:</p>\n<ol>\n<li>Each <code>Floater</code> has its own starting degree of rotation, so they weren&rsquo;t all rotating uniformly.</li>\n<li>Having the <code>transform-origin: top left</code> makes them appear to move around more aimlessly.</li>\n</ol>\n<p>Here&rsquo;s how it looks, we&rsquo;re getting there:</p>\n<p><img src=\"https://blog.owenlacey.dev/uploads/2025/chrome-kmfkeh5e47.gif\" alt=\"Auto-generated description: Small, abstract triangular shapes are scattered across a white background, creating a minimalist pattern.\"></p>\n<h2 id=\"random-floating\">Random floating</h2>\n<p>Finally, I wanted them to float around like little lost asteriods. I decided to make them take a little journey and return to the original place whilst rotating:</p>\n<div class=\"highlight\"><pre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"><code class=\"language-scss\" data-lang=\"scss\"><span style=\"color:#66d9ef\">@mixin</span><span style=\"color:#a6e22e\"> floater-animation</span>($i) {\n\n  $yOffset<span style=\"color:#f92672\">:</span> (<span style=\"color:#a6e22e\">random</span>(<span style=\"color:#ae81ff\">500</span>) <span style=\"color:#f92672\">-</span> <span style=\"color:#ae81ff\">250</span>) <span style=\"color:#f92672\">/</span> <span style=\"color:#ae81ff\">100</span>;\n  $xOffset<span style=\"color:#f92672\">:</span> (<span style=\"color:#a6e22e\">random</span>(<span style=\"color:#ae81ff\">500</span>) <span style=\"color:#f92672\">-</span> <span style=\"color:#ae81ff\">250</span>) <span style=\"color:#f92672\">/</span> <span style=\"color:#ae81ff\">100</span>;\n  <span style=\"color:#66d9ef\">@keyframes</span> <span style=\"color:#f92672\">floater</span><span style=\"color:#e6db74\">#{</span>$i<span style=\"color:#e6db74\">}</span> {\n    <span style=\"color:#f92672\">0</span><span style=\"color:#960050;background-color:#1e0010\">%</span> {\n      <span style=\"color:#a6e22e\">transform</span><span style=\"color:#f92672\">:</span> <span style=\"color:#a6e22e\">translateY</span>(<span style=\"color:#ae81ff\">0</span>) <span style=\"color:#a6e22e\">translateX</span>(<span style=\"color:#ae81ff\">0</span>);\n    }\n    <span style=\"color:#f92672\">50</span><span style=\"color:#960050;background-color:#1e0010\">%</span> {\n      <span style=\"color:#a6e22e\">transform</span><span style=\"color:#f92672\">:</span> <span style=\"color:#a6e22e\">translateY</span>($yOffset <span style=\"color:#f92672\">*</span> <span style=\"color:#ae81ff\">30</span><span style=\"color:#66d9ef\">vh</span>) <span style=\"color:#a6e22e\">translateX</span>($xOffset <span style=\"color:#f92672\">*</span> <span style=\"color:#ae81ff\">30</span><span style=\"color:#66d9ef\">vw</span>);\n    }\n    <span style=\"color:#f92672\">100</span><span style=\"color:#960050;background-color:#1e0010\">%</span> {\n      <span style=\"color:#a6e22e\">transform</span><span style=\"color:#f92672\">:</span> <span style=\"color:#a6e22e\">translateY</span>(<span style=\"color:#ae81ff\">0</span>) <span style=\"color:#a6e22e\">translateX</span>(<span style=\"color:#ae81ff\">0</span>);\n    }\n  }\n}\n\n<span style=\"color:#a6e22e\">.floater</span> {\n\n  $n<span style=\"color:#f92672\">:</span> <span style=\"color:#ae81ff\">200</span>;\n  <span style=\"color:#66d9ef\">@for</span> $i <span style=\"color:#f92672\">from</span> <span style=\"color:#ae81ff\">0</span> <span style=\"color:#f92672\">through</span> $n {\n\n    <span style=\"color:#66d9ef\">@include</span><span style=\"color:#a6e22e\"> spin-animation</span>($i<span style=\"color:#f92672\">,</span> $initialRotate); <span style=\"color:#75715e\">// as before\n</span><span style=\"color:#75715e\"></span>    <span style=\"color:#66d9ef\">@include</span><span style=\"color:#a6e22e\"> floater-animation</span>($i);\n    <span style=\"color:#66d9ef\">&amp;</span><span style=\"color:#f92672\">--</span><span style=\"color:#e6db74\">#{</span>$i<span style=\"color:#e6db74\">}</span> {\n      <span style=\"color:#66d9ef\">@include</span><span style=\"color:#a6e22e\"> random-position</span>; <span style=\"color:#75715e\">// as before      $floaterDuration: random(10) + 5;\n</span><span style=\"color:#75715e\"></span>      <span style=\"color:#a6e22e\">animation</span><span style=\"color:#f92672\">:</span> floater<span style=\"color:#e6db74\">#{</span>$i<span style=\"color:#e6db74\">}</span> <span style=\"color:#e6db74\">#{</span>$floaterDuration<span style=\"color:#e6db74\">}</span>s ease-in-out infinite;\n\n      <span style=\"color:#f92672\">&gt;</span> <span style=\"color:#f92672\">img</span> {\n        <span style=\"color:#a6e22e\">transform-origin</span><span style=\"color:#f92672\">:</span> top left;\n        <span style=\"color:#a6e22e\">animation</span><span style=\"color:#f92672\">:</span> spin<span style=\"color:#e6db74\">#{</span>$i<span style=\"color:#e6db74\">}</span> <span style=\"color:#ae81ff\">30</span><span style=\"color:#66d9ef\">s</span> linear infinite;\n      }\n    }\n  }\n}\n</code></pre></div><p>All the magic numbers in the CSS are based on what felt right when playing around locally with it. Since this was a bit of fun, and I&rsquo;d sunk plenty of time into this already, I decided this was good enough to chuck into production.</p>\n<p><img src=\"https://blog.owenlacey.dev/uploads/2025/chrome-hommpxcu70.gif\" alt=\"final animation\"></p>\n<h2 id=\"but-what-does-the-javascript-look-like\">But what does the javascript look like?</h2>\n<p>As you saw above, my SASS code is pretty questionable, but here&rsquo;s how much <code>Floater</code> function component shaped up:</p>\n<div class=\"highlight\"><pre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"><code class=\"language-jsx\" data-lang=\"jsx\"><span style=\"color:#66d9ef\">import</span> <span style=\"color:#e6db74\">&#34;/src/styles/floater.scss&#34;</span>\n\n<span style=\"color:#66d9ef\">function</span> <span style=\"color:#a6e22e\">Floater</span>({<span style=\"color:#a6e22e\">name</span>, <span style=\"color:#a6e22e\">index</span>}) {\n    <span style=\"color:#66d9ef\">const</span> <span style=\"color:#a6e22e\">imageUrl</span> <span style=\"color:#f92672\">=</span> <span style=\"color:#e6db74\">`./</span><span style=\"color:#e6db74\">${</span><span style=\"color:#66d9ef\">import</span>.<span style=\"color:#a6e22e\">meta</span>.<span style=\"color:#a6e22e\">env</span>.<span style=\"color:#a6e22e\">BASE_URL</span><span style=\"color:#e6db74\">}</span><span style=\"color:#e6db74\">/floaters/</span><span style=\"color:#e6db74\">${</span><span style=\"color:#a6e22e\">name</span><span style=\"color:#e6db74\">}</span><span style=\"color:#e6db74\">`</span>;\n    <span style=\"color:#66d9ef\">return</span> (\n        &lt;<span style=\"color:#f92672\">div</span> <span style=\"color:#a6e22e\">className</span><span style=\"color:#f92672\">=</span>{<span style=\"color:#e6db74\">`floater floater--</span><span style=\"color:#e6db74\">${</span><span style=\"color:#a6e22e\">index</span><span style=\"color:#e6db74\">}</span><span style=\"color:#e6db74\">`</span>}&gt;\n            &lt;<span style=\"color:#f92672\">img</span> <span style=\"color:#a6e22e\">src</span><span style=\"color:#f92672\">=</span>{<span style=\"color:#a6e22e\">imageUrl</span>} <span style=\"color:#a6e22e\">alt</span><span style=\"color:#f92672\">=</span><span style=\"color:#e6db74\">&#34;floater&#34;</span>/&gt;\n        &lt;/<span style=\"color:#f92672\">div</span>&gt;\n    );\n}\n\n<span style=\"color:#66d9ef\">export</span> <span style=\"color:#66d9ef\">default</span> <span style=\"color:#a6e22e\">Floater</span>;\n</code></pre></div><p>Told you! No hacky javascript 😎. I needed to have a <code>div</code> and <code>img</code> so that they could have the <code>floaterX</code> and <code>spinX</code>animations respectively.</p>\n<p>Here&rsquo;s how my site looks without those styles imported:\n<!-- raw HTML omitted --></p>\n<p>Pretty boring right? Lastly, and most importantly, I need to consider people accessing my site with accessibility requirements, so I wrapped the <code>animation</code> CSS properties in the following:</p>\n<div class=\"highlight\"><pre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"><code class=\"language-css\" data-lang=\"css\">@<span style=\"color:#66d9ef\">media</span> <span style=\"color:#f92672\">(</span><span style=\"color:#f92672\">prefers-reduced-motion</span><span style=\"color:#f92672\">:</span> <span style=\"color:#f92672\">no-preference</span><span style=\"color:#f92672\">)</span> { }\n</code></pre></div><h1 id=\"finally\">Finally&hellip;</h1>\n<p>As a treat for getting to the end, why don&rsquo;t you try triple-click on <a href=\"https://owenlacey.dev\">my homepage</a> and see what happens&hellip;</p>\n",
				"content_text": "# Introduction\n\nA recent milestone for me is finally putting together [my personal website](https://owenlacey.dev). Though I'm not expecting this website to be much more than a pointer to where else you might find me, I wanted it to show my personality and to give some examples of things I find inspiring. \n\nIf you've checked out the website, you'll have noticed the floating icons distracting you from from the content I've put on the site. I don't care, they're far cooler than anything I would have to say. These, if you didn't know, are called _penrose triangles_:\n\n<img style=\"max-width: 300px;\" src=\"https://blog.owenlacey.dev/uploads/2025/efe15a4ba0.png\" alt=\"penrose triangle\">\n\nThese triangles are impossible in euclidean geometry, and are the sort of optical illusions that might remind you of the artist Escher's work. For me, they are the simplest way to make your head spin using just a pen & paper; if you've spotted me doodling in meetings (me? never!), I'm probably drawing some of these - I think they're brilliant. \n\n# How I did this\n\nEnough nerding out. After all, the point of this post is to go through how I added them to my site. More specifically, how I made them do that stuff with pure CSS. Here's a quick overview of my approach:\n1. I made the triangles myself on procreate. I enjoy messing around on the family iPad, and figured it might come in handy having these assets in future.\n1. I used SASS for styling, which compiles into CSS, so that I can utilise various [At-Rules](https://sass-lang.com/documentation/at-rules/) to make this CSS-only.\n1. Penrose triangles aren't the only thing I find cool, so I wanted the app to iterate through all the floating icons that might be bundled in my app and randomly decide on an amount of them to use. This way, I might have time to create some Möbius strips, Rubiks cubes, Poké Balls, whatever.\n\nI wanted the icons to idly float around the background of my website in random directions. At the same time, I didn't want my website to be full of loads of hacky javascript code, so I thought it would be fun to try and do this in _pure CSS_. Without the benefit of hindsight I decided to name these icons `Floater`s; something I now regret. Regardless, it reminds me of one of my favourite quotes:\n> _There are only two hard things in Computer Science: cache invalidation and naming things - Phil Karlton_\n\nWith my consultancy hat on, here was my acceptance criteria:\n1. Icons are randomly positioned on the page.\n1. Icons float around in random directions.\n1. Icons have a random degree of rotation.\n\nFirst, I wanted to prove the concept. I needed to prove that I could apply custom behaviour to each icon without writing massive amounts of duplicated CSS. I know that I have tabs on the `index` (a unique identifier) when iterating through the `Floater`s, but how do I pass that through to the styles? I'm not much of a front-end developer, but I like using the [BEM methodology ](https://css-tricks.com/bem-101/) for styles so that my DOM looks like the below:\n\n<img style=\"max-width: 300px;\" src=\"https://blog.owenlacey.dev/uploads/2025/5835bd97b5.png\" alt=\"BEM DOM\">\n\nNow that each `Floater` has its own unique class name, I can style them differently. I can also use `@for` so that I don't have to duplicate the styles for each one:\n\n```scss\n.floater {\n  $n: 5;\n  @for $i from 0 through $n {\n    &--#{$i} {\n      height: 60px + $i * 20px;\n    }\n  }\n}\n```\nThis means that each consecutive `Floater` gets bigger by `20px`, like so:\n\n<img src=\"uploads/2025/26f4aa48a5.png\" alt=\"dynamic sizing of triangles\">\n\nNow we know we can style them differently, that means each `Floater` can have its own _animation_. Let's start small; simply moving up and down:\n\n```scss\n  $n: 9;\n  @for $i from 0 through $n {\n    @keyframes floater#{$i} {\n      0% {\n        transform: translateY(0);\n      }\n      50% {\n        transform: translateY(10 * ($i+1) + px);\n      }\n      100% {\n        transform: translateY(0);\n      }\n    }\n    &--#{$i} {\n      animation: floater#{$i} 1s ease alternate infinite;\n    }\n  }\n```\nThis means that each consecutive `Floater` moves down 10 more pixels:\n\n![bouncing triangles](https://blog.owenlacey.dev/uploads/2025/chrome-f5iy1k4igh.gif)\n\nThis was the final thing I needed to do to prove the concept. Now to actually make it look good...\n\n## Random positioning\n\nI decided to use [mixins](https://sass-lang.com/documentation/at-rules/mixin/) to keep the styles within the class declaration nice and succinct. Here's a `mixin` for random positioning:\n\n```scss\n@mixin random-position {\n  position: absolute;\n  left: random(100) + vw;\n  top: random(100) + vh;\n}\n\n.floater {\n  $n: 200;\n  @for $i from 0 through $n {\n\n    &--#{$i} {\n      @include random-position;\n    }\n  }\n}\n```\nThis uses [random](https://sass-lang.com/documentation/modules/math/#random) to give each `Floater` a random `left` and `top`. This dotted the `Floater`s around nicely like so:\n\n\n<img src=\"uploads/2025/6675b764e7.png\" alt=\"dotted floaters\">\n\n## Random spin\n\nHere's the code to make the `Floater`s spin:\n```scss\n@mixin spin-animation($i, $initialRotate) {\n  @keyframes spin#{$i} {\n    0% {\n      transform: rotate($initialRotate + deg);\n    }\n    100% {\n      transform: rotate($initialRotate + 360deg);\n    }\n  }\n}\n\n.floater {\n  $n: 200;\n  @for $i from 0 through $n {\n    @include spin-animation($i, $initialRotate);\n    &--#{$i} {\n      @include random-position; // as before\n\n      > img {\n        transform-origin: top left;\n        animation: spin#{$i} 30s linear infinite;\n      }\n    }\n  }\n}\n```\nI went with this because:\n1. Each `Floater` has its own starting degree of rotation, so they weren't all rotating uniformly.\n1. Having the `transform-origin: top left` makes them appear to move around more aimlessly.\n\nHere's how it looks, we're getting there: \n\n![Auto-generated description: Small, abstract triangular shapes are scattered across a white background, creating a minimalist pattern.](https://blog.owenlacey.dev/uploads/2025/chrome-kmfkeh5e47.gif)\n\n## Random floating\n\nFinally, I wanted them to float around like little lost asteriods. I decided to make them take a little journey and return to the original place whilst rotating:\n\n```scss\n@mixin floater-animation($i) {\n\n  $yOffset: (random(500) - 250) / 100;\n  $xOffset: (random(500) - 250) / 100;\n  @keyframes floater#{$i} {\n    0% {\n      transform: translateY(0) translateX(0);\n    }\n    50% {\n      transform: translateY($yOffset * 30vh) translateX($xOffset * 30vw);\n    }\n    100% {\n      transform: translateY(0) translateX(0);\n    }\n  }\n}\n\n.floater {\n\n  $n: 200;\n  @for $i from 0 through $n {\n\n    @include spin-animation($i, $initialRotate); // as before\n    @include floater-animation($i);\n    &--#{$i} {\n      @include random-position; // as before      $floaterDuration: random(10) + 5;\n      animation: floater#{$i} #{$floaterDuration}s ease-in-out infinite;\n\n      > img {\n        transform-origin: top left;\n        animation: spin#{$i} 30s linear infinite;\n      }\n    }\n  }\n}\n```\nAll the magic numbers in the CSS are based on what felt right when playing around locally with it. Since this was a bit of fun, and I'd sunk plenty of time into this already, I decided this was good enough to chuck into production.\n\n![final animation](https://blog.owenlacey.dev/uploads/2025/chrome-hommpxcu70.gif)\n\n## But what does the javascript look like?\n\nAs you saw above, my SASS code is pretty questionable, but here's how much `Floater` function component shaped up:\n\n```jsx\nimport \"/src/styles/floater.scss\"\n\nfunction Floater({name, index}) {\n    const imageUrl = `./${import.meta.env.BASE_URL}/floaters/${name}`;\n    return (\n        <div className={`floater floater--${index}`}>\n            <img src={imageUrl} alt=\"floater\"/>\n        </div>\n    );\n}\n\nexport default Floater;\n```\nTold you! No hacky javascript 😎. I needed to have a `div` and `img` so that they could have the `floaterX` and `spinX`animations respectively.\n\nHere's how my site looks without those styles imported:\n<img src=\"uploads/2025/584d41ddc5.png\" alt=\"website without styles\">\n\nPretty boring right? Lastly, and most importantly, I need to consider people accessing my site with accessibility requirements, so I wrapped the `animation` CSS properties in the following:\n\n```css\n@media (prefers-reduced-motion: no-preference) { }\n```\n# Finally...\n\nAs a treat for getting to the end, why don't you try triple-click on [my homepage](https://owenlacey.dev) and see what happens...\n",
				"date_published": "2025-02-26T14:58:36+01:00",
				"url": "https://blog.owenlacey.dev/2025/02/24/animated-images-on-my-website.html",
				"tags": ["I did a thing"]
			},
			{
				"id": "http://owenlacey.micro.blog/2025/02/22/building-probably-the-best-fpl.html",
				"title": "I let Google OR Tools pick my FPL team",
				"content_html": "<p>First of all, I&rsquo;m glad you&rsquo;re here. If we had a venn diagram of &ldquo;software developers&rdquo; and &ldquo;people interested in FPL&rdquo;, it&rsquo;d likely not be much more than us two. Rest assured, if you&rsquo;re only in the former camp I hope there will still be some things of interest. Also, disclaimer, I am by no means a FPL expert: I&rsquo;m sitting rock bottom of my league with friends so think less Liverpool, more Southampton. Perhaps if it were possible to predict what would happen in a game of football (assuming I&rsquo;m smart enough to even do so), it wouldn&rsquo;t be the most popular sport in the world.</p>\n<p>The code for this post can be found in my Github repo <a href=\"https://github.com/owen-lacey/fpl-team-picker\">here</a>.</p>\n<h1 id=\"tldr\">TL;DR</h1>\n<p>For those that just want FPL tips, here is (probably) the best FPL team, not that it&rsquo;ll get you very far:</p>\n<!-- raw HTML omitted -->\n<p>This team is picked based on how many points each player is predicted to score (which I&rsquo;ll go into later).</p>\n<h1 id=\"what-is-fpl\">What is FPL?</h1>\n<p>FPL means Fantasy Premier League. It&rsquo;s a game where you pick a team of players, and your team scores points based on real-live events in premier league games. Here are the rules:</p>\n<ol>\n<li>Pick 15 players: 2 goalkeepers (GK), 5 defenders (DEF), 5 midfielders (MID), 3 forwards (FWD).</li>\n<li>You can&rsquo;t have more than 3 players from a specific team.</li>\n<li>The cost of your team can&rsquo;t exceed the budget of 100M.</li>\n</ol>\n<p>There are around 700 players for 20 different clubs, that&rsquo;s a lot of possible teams. To save this becoming a post on discrete maths, that <em>a lot</em> of possible teams. But what&rsquo;s the &ldquo;best&rdquo; team to pick? What criteria do we use to make this decision? This is what&rsquo;s known as a &ldquo;combinatoral optimisation&rdquo; problem, and that&rsquo;s where Google OR Tools comes in.</p>\n<h1 id=\"what-is-google-or-tools\">What is Google OR Tools?</h1>\n<p><a href=\"https://developers.google.com/optimization\">Google OR Tools</a> is an open source library that allows you to solve problems like this. You can use it in Java, C++, Python and, for our purposes, in C#. The documentation linked here is decent, so I wont go into too much detail as to how it all works. For our use case we&rsquo;re essentially going to ask OR Tools to solve many <code>IntVar</code>s. That is, variables which must take an integer value based on the provided upper and lower bounds. We&rsquo;ll give our <code>IntVar</code>s bounds of <code>[0,1]</code> so that if a player is picked that means its corresponding <code>IntVar</code> will have a value of <code>1</code>. The complexity comes in telling the <code>CpModel</code> what decisions to make based on a player being picked.</p>\n<p>I found it useful to create a child class of OR Tools' <code>CpModel</code> so I can easily keep track of variables that I want to add constraints for:</p>\n<div class=\"highlight\"><pre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"><code class=\"language-csharp\" data-lang=\"csharp\"><span style=\"color:#66d9ef\">public</span> <span style=\"color:#66d9ef\">class</span> <span style=\"color:#a6e22e\">PickFplTeamCpModel</span> : CpModel\n{\n    <span style=\"color:#66d9ef\">public</span> List&lt;FplPlayerSelectionVar&gt; GkSelections = [];\n    <span style=\"color:#66d9ef\">public</span> List&lt;FplPlayerSelectionVar&gt; DefSelections = [];\n    <span style=\"color:#66d9ef\">public</span> List&lt;FplPlayerSelectionVar&gt; MidSelections = [];\n    <span style=\"color:#66d9ef\">public</span> List&lt;FplPlayerSelectionVar&gt; FwdSelections = [];    \n    <span style=\"color:#66d9ef\">public</span> Dictionary&lt;<span style=\"color:#66d9ef\">string</span>, List&lt;IntVar&gt;&gt; TeamSelectionCounts = <span style=\"color:#66d9ef\">new</span>();\n\n    <span style=\"color:#66d9ef\">public</span> List&lt;FplPlayerSelectionVar&gt; Selections =&gt; GkSelections\n        .Concat(DefSelections)\n        .Concat(MidSelections)\n        .Concat(FwdSelections)\n        .ToList();\n}\n</code></pre></div><p><code>FplPlayerSelectionVar</code> is a <code>record</code> that contains the player&rsquo;s details, as well as their selection variable.</p>\n<p>Now, let&rsquo;s add our constraints.</p>\n<h2 id=\"rule-1-2-gk-5-def-5-mid-3-fwd\">Rule #1: 2 GK, 5 DEF, 5 MID, 3 FWD</h2>\n<p>We need to make sure we have the right number of players in each position. We can do this by using the properties on our child class of <code>CpModel</code>:</p>\n<div class=\"highlight\"><pre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"><code class=\"language-cs\" data-lang=\"cs\"><span style=\"color:#75715e\">// Sum up the selections for each position, and ensure it matches the number of players required per position.\n</span><span style=\"color:#75715e\"></span>model.Add(<span style=\"color:#66d9ef\">new</span> SumArray(model.GkSelections) == <span style=\"color:#ae81ff\">2</span>);\nmodel.Add(<span style=\"color:#66d9ef\">new</span> SumArray(model.DefSelections) == <span style=\"color:#ae81ff\">5</span>);\nmodel.Add(<span style=\"color:#66d9ef\">new</span> SumArray(model.MidSelections) == <span style=\"color:#ae81ff\">5</span>);\nmodel.Add(<span style=\"color:#66d9ef\">new</span> SumArray(model.FwdSelections) == <span style=\"color:#ae81ff\">3</span>);\n</code></pre></div><p>A <code>SumArray</code> is an OR Tools object. that sums an array of <code>IntVar</code>s. Think of it as a &ldquo;computed&rdquo; field, dependent on other <code>IntVar</code>s.\nBy doing <code>model.Add</code> we adding a <em>hard constraint</em> to the model. This means that if a solution were to be found that picked only <code>4</code> defenders, the solution would be <em>infeasible</em>.</p>\n<h2 id=\"rule-2-max-3-players-per-team\">Rule #2: max 3 players per team</h2>\n<p>Our <code>TeamSelectionCounts</code> is a dictionary, keyed by team name. We can tell the model to not pick too many players from the same team as follows:</p>\n<div class=\"highlight\"><pre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"><code class=\"language-cs\" data-lang=\"cs\"><span style=\"color:#66d9ef\">foreach</span>(<span style=\"color:#66d9ef\">var</span> (<span style=\"color:#ae81ff\">_</span>, selectionsForTeam) <span style=\"color:#66d9ef\">in</span> model.TeamSelectionCounts)\n{\n    <span style=\"color:#75715e\">// This sums up all the 0&#39;s and 1&#39;s for a team.\n</span><span style=\"color:#75715e\"></span>    <span style=\"color:#66d9ef\">var</span> playersSelectedForTeam = <span style=\"color:#66d9ef\">new</span> SumArray(selectionsForTeam);\n    model.Add(playersSelectedForTeam &lt;= <span style=\"color:#ae81ff\">3</span>);\n}\n</code></pre></div><h2 id=\"rule-3-squad-cost\">Rule #3: squad cost</h2>\n<p>This one&rsquo;s a bit more involved as we&rsquo;re not simply summing up <code>1</code>s and <code>0</code>s, we&rsquo;re summing up player costs based on these values. If you&rsquo;ve done any work with vectors before you might have come across <a href=\"https://www.wolframalpha.com/input?i=dot+product\">dot product</a> operations. We&rsquo;re going to use this to sum up the cost of all selected players. That is, the <em>dot product</em> of their selection vars and their costs. The <code>FplPlayerSelectionVar</code> type contains these pieces of information:</p>\n<div class=\"highlight\"><pre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"><code class=\"language-cs\" data-lang=\"cs\"><span style=\"color:#66d9ef\">public</span> record FplPlayerSelectionVar\n{\n    <span style=\"color:#66d9ef\">public</span> IntVar Selected { <span style=\"color:#66d9ef\">get</span>; init; }\n    <span style=\"color:#66d9ef\">public</span> <span style=\"color:#66d9ef\">int</span> Cost { <span style=\"color:#66d9ef\">get</span>; init; }\n    <span style=\"color:#66d9ef\">public</span> <span style=\"color:#66d9ef\">decimal</span> PredictedPoints { <span style=\"color:#66d9ef\">get</span>; init; } \n}\n</code></pre></div><p>We&rsquo;ll get to <code>PredictedPoints</code> later. By keeping this information together, we can easily sum up the costs of selected players like so:</p>\n<div class=\"highlight\"><pre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"><code class=\"language-cs\" data-lang=\"cs\"><span style=\"color:#66d9ef\">var</span> allPlayerSelections = model.Selections.Select(p =&gt; p.Selected).ToList();\n<span style=\"color:#66d9ef\">var</span> allPlayerCosts = model.Selections.Select(p =&gt; p.Cost).ToList();\n<span style=\"color:#66d9ef\">var</span> squadCost = LinearExpr.ScalProd(allPlayerSelections, allPlayerCosts);\nmodel.Add(squadCost &lt;= <span style=\"color:#ae81ff\">1000</span>);\n</code></pre></div><blockquote>\n<p>Note: we&rsquo;re using <code>1000</code> rather than <code>100</code> because player cost is represented in 100,000s e.g if a player cost 7.9M, their <code>int Cost</code> would be <code>79</code>.</p>\n</blockquote>\n<p><code>LinearExpr.ScalProd</code> does the <em>dot product</em> as described earlier.</p>\n<h2 id=\"the-objective\">The objective</h2>\n<p>At this point, we have a <em>feasible</em> solution to the problem. I could go into the web app and click &ldquo;Save&rdquo; without any validation preventing me from doing so. If this were purely a constraint solving problem (e.g doing a Sudoku is a good example of this) where no two solutions are better than another we&rsquo;d be done. However, we want the <em>best</em> team: I want to wipe the floor with my friends and be the envy of FPL merchants everywhere.</p>\n<p>In order to say an FPL team is the best possible team, the model needs to be able to compare two solutions together, and say one solution is better than another. OR Tools gets all <em>feasible</em> solutions, labelling the one with the best score as the <em>optimal</em> solution. In order to change this into an optimisation problem, we need to give the model an <em>objective</em>.</p>\n<p>This is where it gets quite squishy. If we knew for certain how many points a player would score in a given game, other than that being a very boring prospect, I&rsquo;d be doing a lot better in my FPL leagues than I currently am.</p>\n<p>So what do we go with?</p>\n<p><strong>Selection-y-est</strong>: we could pick the players most selected by other players. Using this hive-mind approach would mean we&rsquo;re more likely to pick the no-brainers, but the model wouldn&rsquo;t give us any hipster choices that would make other players go &ldquo;how did I not think of that?!&rdquo;.</p>\n<p><strong>Point-y-est</strong>: we could pick the ones who&rsquo;ve scored the most points so far. This would make a lot of sense, but would not select players who&rsquo;ve recently transfered, or have been out injured for a while.</p>\n<p><strong>Form-y-est</strong>: FPL has a concept of &ldquo;form&rdquo;. However it&rsquo;s a bit black-boxed and it&rsquo;s not very clear how this is calculated, and therefore how it corresponds to the amount of points a player might score.</p>\n<p>How about some combination of the above? I landed on putting together a very ropey linear regression model built with <a href=\"https://dotnet.microsoft.com/en-us/apps/ai/ml-dotnet\">ML.NET</a>. I won&rsquo;t go into how this model was built, but essentially it would use past performance to predict points scored by a player for the upcoming gameweek. Inexplicably, this model was obsessed with Georginio Rutter; a very average player by FPL standards. Reassuringly, it consistently predicted that Mo Salah would score highly so I decided it was &ldquo;good enough&rdquo;. If there were reliable, publicly available information about a player&rsquo;s expected points (XP), I would swap out my linear regression model without hesitation.</p>\n<p>Here&rsquo;s how I told the model to pick me a team with the highest predicted points:</p>\n<div class=\"highlight\"><pre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"><code class=\"language-cs\" data-lang=\"cs\"><span style=\"color:#66d9ef\">var</span> allPlayerPredictedPoints = model.Selections.Select(p =&gt; (<span style=\"color:#66d9ef\">int</span>)Math.Round(p.PredictedPoints * <span style=\"color:#ae81ff\">100</span>)).ToList();\n<span style=\"color:#66d9ef\">var</span> allPlayerSelections = model.Selections.Select(p =&gt; p.Selected).ToList();\n<span style=\"color:#66d9ef\">var</span> teamPredictedPoints = LinearExpr.ScalProd(model.Selections, allPlayerPredictedPoints);\nmodel.Maximize(teamPredictedPoints);\n</code></pre></div><p>The important bit here is <code>model.Maximize</code>, this means the model&rsquo;s solution will be the one with the highest calculated <code>teamPredictedPoints</code>.</p>\n<h1 id=\"in-practice\">In practice</h1>\n<p>Lets put all this together. Here are the top players in terms of predicted points for the upcoming gameweek (this is GW26 on 22nd Feb 2025):</p>\n<!-- raw HTML omitted -->\n<p>An immediate observation is that we won&rsquo;t be able to pick all the players in this list due to fact that we can&rsquo;t have more than five midfielders.  Chris Wood is the first FWD that appears in at #12 with a XP of <code>8.0</code>, with Erling Haaland in at #17 with <code>7.2</code> (I hope not - he&rsquo;s playing Liverpool this weekend). Let&rsquo;s compare that with the team my model picked:</p>\n<!-- raw HTML omitted -->\n<p>In table form:</p>\n<!-- raw HTML omitted -->\n<p>Let&rsquo;s check our rules:</p>\n<ol>\n<li>✅ 2 GKs, 5 DEF, 5 MID, 3 FWD</li>\n<li>✅ Max 3 players per team</li>\n<li>✅ Total team cost: 90.8M</li>\n</ol>\n<p>The predicted number of points this team scores is <code>116.1</code>.</p>\n<blockquote>\n<p><em>Narrator: they did not. They scored 70 points.</em></p>\n</blockquote>\n<p>Now, I&rsquo;ve been scoring around <code>55</code> points on average per gameweek, so this would be a big change in fortunes. I&rsquo;ll need to choose four players to go on the bench here, so I reckon I would be happy with a score of <code>90</code>. As you can see, the model ended up picking the five best midfielders. It may look like it picked any old goalkeeper, however the two listed here are in fact the highest ranked, followed by Martin Dúbravka at #98.</p>\n<h1 id=\"next-steps\">Next steps</h1>\n<p>As mentioned a few times, it isn&rsquo;t just self-deprecation, this application is far from perfect. I&rsquo;d love to be able to tell you how I&rsquo;ve soared up the FPL rankings since I started doing this, but that&rsquo;s not the case. These are the changes I&rsquo;d like to make to the model in future.</p>\n<h2 id=\"prioritise-starting-xi\">Prioritise starting XI</h2>\n<p>The FPL squad has a size of 15, but you only score points for the 11 players you pick for the starting lineup. Therefore, why should we waste budget on benchwarmers that don&rsquo;t give me any points?</p>\n<h2 id=\"transfers\">Transfers</h2>\n<p>You get a free transfer every game week and these cumulate if you don&rsquo;t use them. Any further transfers cost you 4 points. You get a wildcard twice a season which gives you unlimited transfers, but day-to-day gameweeks need to support the scenario of &ldquo;I have these players, and X free transfers. Tell me what transfers to do&rdquo;.</p>\n<h2 id=\"better-xp\">Better XP</h2>\n<p>As mentioned above, this solution is only as good as the XP data is. I need to either work on my linear regression model, or find some XP data that&rsquo;s less fixated on Georginio Rutter.</p>\n<h2 id=\"think-more-long-term\">Think more long-term</h2>\n<p>At the moment, we predict the points based on the next game, but sometimes we have double-gameweeks i.e a player plays twice. It also might be that a specific player has a particularly good run of easier opponents coming up, so getting them in the team now might make sense, even if they wouldn&rsquo;t do as well as someone else in the next game.</p>\n<h1 id=\"finally\">Finally</h1>\n<p>There&rsquo;s a lot of avenues (or rabbit holes?) we could go down for this. There&rsquo;s also plenty of third-party websites out there that facilitate FPL admin tasks. All things being equal, I found this to be a really fun application of OR Tools.</p>\n<p>You can find the code for this post on my Github repo <a href=\"https://github.com/owen-lacey/fpl-team-picker\">here</a>.</p>\n",
				"content_text": "First of all, I'm glad you're here. If we had a venn diagram of \"software developers\" and \"people interested in FPL\", it'd likely not be much more than us two. Rest assured, if you're only in the former camp I hope there will still be some things of interest. Also, disclaimer, I am by no means a FPL expert: I'm sitting rock bottom of my league with friends so think less Liverpool, more Southampton. Perhaps if it were possible to predict what would happen in a game of football (assuming I'm smart enough to even do so), it wouldn't be the most popular sport in the world. \n\nThe code for this post can be found in my Github repo [here](https://github.com/owen-lacey/fpl-team-picker).\n\n# TL;DR\nFor those that just want FPL tips, here is (probably) the best FPL team, not that it'll get you very far:\n\n<img src=\"uploads/2025/669ff78e2c.png\" alt=\"Screenshot of my FPL team\">\n\nThis team is picked based on how many points each player is predicted to score (which I'll go into later).\n\n# What is FPL?\nFPL means Fantasy Premier League. It's a game where you pick a team of players, and your team scores points based on real-live events in premier league games. Here are the rules:\n\n1. Pick 15 players: 2 goalkeepers (GK), 5 defenders (DEF), 5 midfielders (MID), 3 forwards (FWD).\n1. You can't have more than 3 players from a specific team.\n1. The cost of your team can't exceed the budget of 100M.\n\nThere are around 700 players for 20 different clubs, that's a lot of possible teams. To save this becoming a post on discrete maths, that _a lot_ of possible teams. But what's the \"best\" team to pick? What criteria do we use to make this decision? This is what's known as a \"combinatoral optimisation\" problem, and that's where Google OR Tools comes in.\n\n# What is Google OR Tools?\n\n[Google OR Tools](https://developers.google.com/optimization) is an open source library that allows you to solve problems like this. You can use it in Java, C++, Python and, for our purposes, in C#. The documentation linked here is decent, so I wont go into too much detail as to how it all works. For our use case we're essentially going to ask OR Tools to solve many `IntVar`s. That is, variables which must take an integer value based on the provided upper and lower bounds. We'll give our `IntVar`s bounds of `[0,1]` so that if a player is picked that means its corresponding `IntVar` will have a value of `1`. The complexity comes in telling the `CpModel` what decisions to make based on a player being picked. \n\nI found it useful to create a child class of OR Tools' `CpModel` so I can easily keep track of variables that I want to add constraints for:\n```csharp\npublic class PickFplTeamCpModel : CpModel\n{\n    public List<FplPlayerSelectionVar> GkSelections = [];\n    public List<FplPlayerSelectionVar> DefSelections = [];\n    public List<FplPlayerSelectionVar> MidSelections = [];\n    public List<FplPlayerSelectionVar> FwdSelections = [];    \n    public Dictionary<string, List<IntVar>> TeamSelectionCounts = new();\n\n    public List<FplPlayerSelectionVar> Selections => GkSelections\n        .Concat(DefSelections)\n        .Concat(MidSelections)\n        .Concat(FwdSelections)\n        .ToList();\n}\n```\n`FplPlayerSelectionVar` is a `record` that contains the player's details, as well as their selection variable.\n\nNow, let's add our constraints.\n\n## Rule #1: 2 GK, 5 DEF, 5 MID, 3 FWD\nWe need to make sure we have the right number of players in each position. We can do this by using the properties on our child class of `CpModel`:\n```cs\n// Sum up the selections for each position, and ensure it matches the number of players required per position.\nmodel.Add(new SumArray(model.GkSelections) == 2);\nmodel.Add(new SumArray(model.DefSelections) == 5);\nmodel.Add(new SumArray(model.MidSelections) == 5);\nmodel.Add(new SumArray(model.FwdSelections) == 3);\n```\nA `SumArray` is an OR Tools object. that sums an array of `IntVar`s. Think of it as a \"computed\" field, dependent on other `IntVar`s.\nBy doing `model.Add` we adding a _hard constraint_ to the model. This means that if a solution were to be found that picked only `4` defenders, the solution would be _infeasible_.\n\n## Rule #2: max 3 players per team\nOur `TeamSelectionCounts` is a dictionary, keyed by team name. We can tell the model to not pick too many players from the same team as follows:\n\n```cs\nforeach(var (_, selectionsForTeam) in model.TeamSelectionCounts)\n{\n    // This sums up all the 0's and 1's for a team.\n    var playersSelectedForTeam = new SumArray(selectionsForTeam);\n    model.Add(playersSelectedForTeam <= 3);\n}\n```\n## Rule #3: squad cost\nThis one's a bit more involved as we're not simply summing up `1`s and `0`s, we're summing up player costs based on these values. If you've done any work with vectors before you might have come across [dot product](https://www.wolframalpha.com/input?i=dot+product) operations. We're going to use this to sum up the cost of all selected players. That is, the _dot product_ of their selection vars and their costs. The `FplPlayerSelectionVar` type contains these pieces of information:\n\n```cs\npublic record FplPlayerSelectionVar\n{\n    public IntVar Selected { get; init; }\n    public int Cost { get; init; }\n    public decimal PredictedPoints { get; init; } \n}\n```\nWe'll get to `PredictedPoints` later. By keeping this information together, we can easily sum up the costs of selected players like so:\n```cs\nvar allPlayerSelections = model.Selections.Select(p => p.Selected).ToList();\nvar allPlayerCosts = model.Selections.Select(p => p.Cost).ToList();\nvar squadCost = LinearExpr.ScalProd(allPlayerSelections, allPlayerCosts);\nmodel.Add(squadCost <= 1000);\n```\n> Note: we're using `1000` rather than `100` because player cost is represented in 100,000s e.g if a player cost 7.9M, their `int Cost` would be `79`.\n\n`LinearExpr.ScalProd` does the _dot product_ as described earlier.\n\n## The objective\nAt this point, we have a _feasible_ solution to the problem. I could go into the web app and click \"Save\" without any validation preventing me from doing so. If this were purely a constraint solving problem (e.g doing a Sudoku is a good example of this) where no two solutions are better than another we'd be done. However, we want the _best_ team: I want to wipe the floor with my friends and be the envy of FPL merchants everywhere.\n\nIn order to say an FPL team is the best possible team, the model needs to be able to compare two solutions together, and say one solution is better than another. OR Tools gets all _feasible_ solutions, labelling the one with the best score as the _optimal_ solution. In order to change this into an optimisation problem, we need to give the model an _objective_.\n\nThis is where it gets quite squishy. If we knew for certain how many points a player would score in a given game, other than that being a very boring prospect, I'd be doing a lot better in my FPL leagues than I currently am. \n\nSo what do we go with? \n\n**Selection-y-est**: we could pick the players most selected by other players. Using this hive-mind approach would mean we're more likely to pick the no-brainers, but the model wouldn't give us any hipster choices that would make other players go \"how did I not think of that?!\".\n\n**Point-y-est**: we could pick the ones who've scored the most points so far. This would make a lot of sense, but would not select players who've recently transfered, or have been out injured for a while.\n\n**Form-y-est**: FPL has a concept of \"form\". However it's a bit black-boxed and it's not very clear how this is calculated, and therefore how it corresponds to the amount of points a player might score.\n\nHow about some combination of the above? I landed on putting together a very ropey linear regression model built with [ML.NET](https://dotnet.microsoft.com/en-us/apps/ai/ml-dotnet). I won't go into how this model was built, but essentially it would use past performance to predict points scored by a player for the upcoming gameweek. Inexplicably, this model was obsessed with Georginio Rutter; a very average player by FPL standards. Reassuringly, it consistently predicted that Mo Salah would score highly so I decided it was \"good enough\". If there were reliable, publicly available information about a player's expected points (XP), I would swap out my linear regression model without hesitation.\n\nHere's how I told the model to pick me a team with the highest predicted points:\n\n```cs\nvar allPlayerPredictedPoints = model.Selections.Select(p => (int)Math.Round(p.PredictedPoints * 100)).ToList();\nvar allPlayerSelections = model.Selections.Select(p => p.Selected).ToList();\nvar teamPredictedPoints = LinearExpr.ScalProd(model.Selections, allPlayerPredictedPoints);\nmodel.Maximize(teamPredictedPoints);\n```\nThe important bit here is `model.Maximize`, this means the model's solution will be the one with the highest calculated `teamPredictedPoints`.\n\n# In practice\nLets put all this together. Here are the top players in terms of predicted points for the upcoming gameweek (this is GW26 on 22nd Feb 2025):\n\n<table>\n<thead>\n<th>Rank</th>\n<th>Player</th><th>Team</th><th>Position</th><th>XP</th>\n</thead>\n<tbody>\n<tr><td>1</td>\n<td>Antoine Semenyo</td><td>BOU</td><td>MID</td><td>10.3</td></tr>\n<tr><td>2</td>\n<td>Bryan Mbeumo</td><td>BRE</td><td>MID</td><td>10.3</td></tr>\n<tr><td>3</td>\n<td>Mohamed Salah</td><td>LIV</td><td>MID</td><td>9.4</td></tr>\n<tr><td>4</td>\n<td>Georginio Rutter</td><td>BHA</td><td>MID</td><td>9.3</td></tr>\n<tr><td>5</td>\n<td>Jarrod Bowen</td><td>WHU</td><td>MID</td><td>9.2</td></tr>\n<tr><td>6</td>\n<td>Joško Gvardiol</td><td>MCI</td><td>DEF</td><td>8.5</td></tr>\n<tr><td>7</td>\n<td>Rayan Aït-Nouri</td><td>WOL</td><td>DEF</td><td>8.5</td></tr>\n<tr><td>8</td>\n<td>Cole Palmer</td><td>CHE</td><td>MID</td><td>8.4</td></tr>\n<tr><td>9</td>\n<td>Brennan Johnson</td><td>TOT</td><td>MID</td><td>8.3</td></tr>\n<tr><td>10</td>\n<td>Diogo Teixeira da Silva</td><td>LIV</td><td>MID</td><td>8.1</td></tr>\n</tbody>\n</table>\n\nAn immediate observation is that we won't be able to pick all the players in this list due to fact that we can't have more than five midfielders.  Chris Wood is the first FWD that appears in at #12 with a XP of `8.0`, with Erling Haaland in at #17 with `7.2` (I hope not - he's playing Liverpool this weekend). Let's compare that with the team my model picked:\n\n<img src=\"uploads/2025/image.png\" alt=\"Screenshot of application OR Tools solution\">\n\nIn table form:\n\n<table>\n<thead>\n<th>Rank</th><th>Position-specific Rank</th>\n<th>Player</th><th>Team</th><th>Position</th><th>XP</th>\n</thead>\n<tbody>\n<tr><td>79</td>\t<td>1</td><td>Emiliano Martínez Romero</td>\t<td>AVL</td>\t<td>GK</td>\t<td>4.4</td>\n<tr><td>80</td>\t<td>2</td><td>Bart Verbruggen</td>\t<td>BHA</td>\t<td>GK</td>\t<td>4.3</td>\n<tr><td>20</td>\t<td>3</td><td>Lucas Digne</td>\t<td>AVL</td>\t<td>DEF</td>\t<td>7.0</td>\n<tr><td>28</td>\t<td>5</td><td>Michael Keane</td>\t<td>EVE</td>\t<td>DEF</td>\t<td>6.3</td>\n<tr><td>6</td>\t<td>1</td><td>Joško Gvardiol</td>\t<td>MCI</td>\t<td>DEF</td>\t<td>8.5</td>\n<tr><td>27</td>\t<td>4</td><td>Rico Lewis</td>\t<td>MCI</td>\t<td>DEF</td>\t<td>6.6</td>\n<tr><td>7</td>\t<td>2</td><td>Rayan Aït-Nouri</td>\t<td>WOL</td>\t<td>DEF</td>\t<td>8.5</td>\n<tr><td>1</td>\t<td>1</td><td>Antoine Semenyo</td>\t<td>BOU</td>\t<td>MID</td>\t<td>10.3</td>\n<tr><td>2</td>\t<td>2</td><td>Bryan Mbeumo</td>\t<td>BRE</td>\t<td>MID</td>\t<td>10.3</td>\n<tr><td>4</td>\t<td>4</td><td>Georginio Rutter</td>\t<td>BHA</td>\t<td>MID</td>\t<td>9.3</td>\n<tr><td>3</td>\t<td>3</td><td>Mohamed Salah</td>\t<td>LIV</td>\t<td>MID</td>\t<td>9.4</td>\n<tr><td>5</td>\t<td>5</td><td>Jarrod Bowen</td>\t<td>WHU</td>\t<td>MID</td>\t<td>9.2</td>\n<tr><td>12</td>\t<td>1</td><td>Chris Wood</td>\t<td>NFO</td>\t<td>FWD</td>\t<td>8.0</td>\n<tr><td>18</td>\t<td>3</td><td>Dominic Solanke-Mitchell</td>\t<td>TOT</td>\t<td>FWD</td>\t<td>7.2</td>\n<tr><td>25</td>\t<td>8</td><td>Michail Antonio</td>\t<td>WHU</td>\t<td>FWD</td>\t<td>7.0</td>\n</tbody>\n</table>\n\nLet's check our rules:\n\n1. ✅ 2 GKs, 5 DEF, 5 MID, 3 FWD\n1. ✅ Max 3 players per team\n1. ✅ Total team cost: 90.8M\n\nThe predicted number of points this team scores is `116.1`. \n\n>_Narrator: they did not. They scored 70 points._\n\nNow, I've been scoring around `55` points on average per gameweek, so this would be a big change in fortunes. I'll need to choose four players to go on the bench here, so I reckon I would be happy with a score of `90`. As you can see, the model ended up picking the five best midfielders. It may look like it picked any old goalkeeper, however the two listed here are in fact the highest ranked, followed by Martin Dúbravka at #98.\n\n\n# Next steps\nAs mentioned a few times, it isn't just self-deprecation, this application is far from perfect. I'd love to be able to tell you how I've soared up the FPL rankings since I started doing this, but that's not the case. These are the changes I'd like to make to the model in future.\n\n## Prioritise starting XI\nThe FPL squad has a size of 15, but you only score points for the 11 players you pick for the starting lineup. Therefore, why should we waste budget on benchwarmers that don't give me any points? \n\n## Transfers\nYou get a free transfer every game week and these cumulate if you don't use them. Any further transfers cost you 4 points. You get a wildcard twice a season which gives you unlimited transfers, but day-to-day gameweeks need to support the scenario of \"I have these players, and X free transfers. Tell me what transfers to do\".\n\n## Better XP\nAs mentioned above, this solution is only as good as the XP data is. I need to either work on my linear regression model, or find some XP data that's less fixated on Georginio Rutter.\n\n## Think more long-term\nAt the moment, we predict the points based on the next game, but sometimes we have double-gameweeks i.e a player plays twice. It also might be that a specific player has a particularly good run of easier opponents coming up, so getting them in the team now might make sense, even if they wouldn't do as well as someone else in the next game.\n\n# Finally\n\nThere's a lot of avenues (or rabbit holes?) we could go down for this. There's also plenty of third-party websites out there that facilitate FPL admin tasks. All things being equal, I found this to be a really fun application of OR Tools.\n\nYou can find the code for this post on my Github repo [here](https://github.com/owen-lacey/fpl-team-picker).\n",
				"date_published": "2025-02-23T18:03:57+01:00",
				"url": "https://blog.owenlacey.dev/2025/02/22/building-probably-the-best-fpl.html",
				"tags": ["I did a thing"]
			}
	]
}
